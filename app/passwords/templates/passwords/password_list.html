{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Passwords</title>
    <link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h2>Passwords</h2>
    <a href="{% url 'password_create' %}" class="btn btn-primary mb-3">New Entry</a>
    <a href="{% url 'deleted_passwords' %}" class="btn btn-secondary mb-3">Deleted Records</a>
    <form method="get" action="{% url 'password_list' %}" class="mb-3 d-flex">
        <div class="input-group">
            <input type="text" name="q" value="{{ query|default_if_none:'' }}" class="form-control" placeholder="Search by machine, label, username, or password">
            <button type="submit" class="btn btn-primary">Search</button>
            <button type="button" class="btn btn-outline-dark" onclick="clearSearch()">X</button>
        </div>
    </form>
    <table class="table table-bordered table-hover">
        <thead>
            <tr>
                <th><a href="?sort=machine">Machine</a></th>
                <th><a href="?sort=label">Label</a></th>
                <th><a href="?sort=username">Username</a></th>
                <th><a href="?sort=password">Password</a></th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for password in passwords %}
            <tr>
                <td>{{ password.machine }}</td>
                <td>{{ password.label }}</td>
                <td>{{ password.username }}</td>
                <td>{{ password.password }}</td>
                <td>
                    <a href="{% url 'password_edit' password.pk %}" class="btn btn-warning">Edit</a>
                    <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ password.pk }}">Delete</button>

                    <div class="modal fade" id="deleteModal{{ password.pk }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ password.pk }}" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="deleteModalLabel{{ password.pk }}">Confirm Deletion</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <p>Type "<span style="color: red;">DELETE</span>" below to confirm the deletion of this password for <strong>{{ password.machine }}</strong>.</p>
                                    <input type="text" class="form-control" id="confirmDelete{{ password.pk }}">
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-danger" onclick="confirmDeletion('{{ password.pk }}')">Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script>
    function clearSearch() {
        var searchInput = document.querySelector('input[name="q"]');
        searchInput.value = '';
        searchInput.form.submit();
    }

    function confirmDeletion(pk) {
        var confirmInput = document.getElementById('confirmDelete' + pk);
        if (confirmInput.value === "DELETE") {
            window.location.href = "{% url 'password_delete' 0 %}".replace('0', pk);
        } else {
            alert("You must type 'DELETE' to confirm.");
        }
    }
</script>
</body>
</html>
