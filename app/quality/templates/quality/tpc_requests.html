{# templates/quality/tpc_requests.html #}
{% extends "parent.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet"
      href="https://cdn.datatables.net/2.0.0/css/dataTables.dataTables.min.css">

<div class="container mt-5">
  <h2>TPC Requests</h2>

  <table id="tpc-table" class="table table-striped table-bordered" style="width:100%">
    <thead>
      <!-- 1st row: headings -->
      <tr>
        <th>ID</th>
        <th>Date requested</th>
        <th>Issuer</th>
        <th>Reason</th>
        <th>Process</th>
        <th>Supplier Issue</th>
        <th>Machine #</th>
        <th>Expiration</th>
        <th>Approved?</th>
      </tr>
      <!-- 2nd row: small inputs used by DataTables for live-search -->
      <tr>
        {% for _ in "012345678" %}
          <th><input type="text" class="form-control form-control-sm"
                     placeholder="Searchâ€¦" /></th>
        {% endfor %}
      </tr>
    </thead>

    <tbody>
      {% for t in tpcs %}
        <tr>
          <td>{{ t.pk }}</td>
          <td>{{ t.date_requested }}</td>
          <td>{{ t.issuer_name }}</td>
          <td>{{ t.reason }}</td>
          <td>{{ t.process }}</td>
          <td>{{ t.supplier_issue|yesno:"Yes,No" }}</td>
          <td>{{ t.machine_number }}</td>
          <td>{{ t.expiration_date }}</td>
          <td>{{ t.approved|yesno:"Yes,No" }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- JS dependencies -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script src="https://cdn.datatables.net/2.0.0/js/dataTables.min.js"></script>

<script>
  $(function () {
    // initialise
    const table = new DataTable('#tpc-table', {
      orderCellsTop: true,     // make sure sort works with the search row on top
      fixedHeader: true        // nice UX when scrolling
    });

    // hook up each header input to its column search
    $('#tpc-table thead tr:eq(1) th').each(function (i) {
      $('input', this).on('keyup change clear', function () {
        if (table.column(i).search() !== this.value) {
          table.column(i).search(this.value).draw();
        }
      });
    });
  });
</script>
{% endblock %}
