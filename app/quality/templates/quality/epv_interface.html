{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPV Interface</title>
    <link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <div class="card">
            <div class="card-header">
                <h2>EPV Interface - Table Data</h2>
            </div>
            <div class="card-body">
                <!-- Filters -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <label for="qc1Dropdown" class="form-label">QC1</label>
                        <select id="qc1Dropdown" class="form-select">
                            <option value="">-- Select QC1 --</option>
                            {% for qc1 in distinct_qc1_values %}
                                <option value="{{ qc1 }}">{{ qc1 }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- Table -->
                <div class="table-responsive">
                    <table id="dataTable" class="table table-bordered table-striped">
                        <thead class="thead-light">
                            <tr>
                                <th>QC1</th>
                                <th>OP1</th>
                                <th>Check1</th>
                                <th>Desc1</th>
                                <th>Method1</th>
                                <th>Interval1</th>
                                <th>Person</th>
                                <th>Asset</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in table_data %}
                                <tr>
                                    <td>{{ row.QC1 }}</td>
                                    <td>{{ row.OP1 }}</td>
                                    <td>{{ row.Check1 }}</td>
                                    <td>{{ row.Desc1 }}</td>
                                    <td>{{ row.Method1 }}</td>
                                    <td>{{ row.Interval1 }}</td>
                                    <td>{{ row.Person }}</td>
                                    <td>{{ row.Asset }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const qc1Dropdown = document.getElementById("qc1Dropdown");
            const dataTable = document.getElementById("dataTable").querySelector("tbody");

            // Function to fetch filtered data and update the table
            function updateTable(qc1) {
                $.ajax({
                    url: "/quality/fetch-filtered-data/",
                    method: "GET",
                    data: { qc1: qc1 },
                    success: function (response) {
                        // Clear the table
                        dataTable.innerHTML = "";

                        // Populate the table with filtered data
                        response.table_data.forEach(row => {
                            const tableRow = document.createElement("tr");
                            tableRow.innerHTML = `
                                <td>${row.QC1}</td>
                                <td>${row.OP1}</td>
                                <td>${row.Check1}</td>
                                <td>${row.Desc1}</td>
                                <td>${row.Method1}</td>
                                <td>${row.Interval1}</td>
                                <td>${row.Person}</td>
                                <td>${row.Asset}</td>
                            `;
                            dataTable.appendChild(tableRow);
                        });
                    },
                    error: function () {
                        alert("Error fetching data.");
                    }
                });
            }

            // Event listener for dropdown change
            qc1Dropdown.addEventListener("change", function () {
                const selectedQC1 = qc1Dropdown.value;
                updateTable(selectedQC1);
            });
        });
    </script>
</body>
</html>
