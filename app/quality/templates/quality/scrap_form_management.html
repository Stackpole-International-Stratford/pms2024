{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Scrap Form Management</title>
  <link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
  <style>
    .highlight {
      color: red;
      font-weight: bold;
    }
    .part-number-box {
      max-height: 200px;
      overflow-y: scroll;
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 20px;
    }
    .part-number-box li {
      cursor: pointer;
    }
  </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="{% url 'quality_index' %}">
            <button type="button" class="btn btn-outline-primary mx-3">Back</button>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
    </nav>
  <div class="container mt-4">
    {% block content %}
    <h2>Scrap Form Management</h2>
    <a href="{% url 'feat_create' %}" class="btn btn-primary mb-3">Start New Form</a>

    <div class="row">
      <div class="col-md-6">
        <div class="part-number-box">
          <ul class="list-group">
            {% for part in parts %}
              <li class="list-group-item" data-part-number="{{ part.part_number }}">{{ part.part_number }}</li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <table id="feat-table" class="table table-striped table-bordered mt-4">
      <thead class="thead-dark">
        <tr>
          <th>Part Number</th>
          <th>Feat Name</th>
          <th>Order</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for part in parts %}
        <tr class="part-row" data-part-number="{{ part.part_number }}">
          <td rowspan="{{ part.feat_set.count|add:1 }}" class="part-number">{{ part.part_number }}</td>
          {% for feat in part.feat_set.all %}
          {% if not forloop.first %}<tr class="feat-row" data-part-number="{{ part.part_number }}">{% endif %}
          <td class="feat-name">{{ feat.name }}</td>
          <td class="feat-order">{{ feat.order }}</td>
          <td>
            <a href="{% url 'feat_update' feat.pk %}" class="btn btn-sm btn-warning">Edit</a>
            <a href="{% url 'feat_delete' feat.pk %}" class="btn btn-sm btn-danger">Delete</a>
          </td>
          </tr>
          {% endfor %}
          {% if part.feat_set.count == 0 %}
          <tr class="feat-row" data-part-number="{{ part.part_number }}">
            <td colspan="3">No feats associated</td>
          </tr>
          {% endif %}
          <!-- Add Feat Button -->
          <tr class="feat-row" data-part-number="{{ part.part_number }}">
            <td colspan="3">
              <a href="{% url 'feat_create' %}?part_id={{ part.id }}" class="btn btn-sm btn-success">Add Feat</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    {% endblock %}
  </div>

  <script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const partNumberItems = document.querySelectorAll('.part-number-box li');
      const rows = document.querySelectorAll('#feat-table tbody tr');

      partNumberItems.forEach(item => {
        item.addEventListener('click', function() {
          const selectedPartNumber = this.getAttribute('data-part-number');

          // Hide all rows initially
          rows.forEach(row => {
            if (row.getAttribute('data-part-number') === selectedPartNumber) {
              row.style.display = '';
            } else {
              row.style.display = 'none';
            }
          });
        });
      });

      // Initially hide all rows until a part number is selected
      rows.forEach(row => {
        row.style.display = 'none';
      });
    });
  </script>
</body>
</html>
