<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TPC #{{ tpc.pk }} – Print</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    /* Global reset */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      padding: 0;
      font: 11pt -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, system-ui, sans-serif;
      color: #000;
      background: #fff;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
    h1,h2,h3 { margin: 0 0 6pt; font-weight: 700; }
    small, .muted { color: #555; }

    /* One-page canvas (A4 landscape) */
    .page {
      width: 297mm;
      height: 210mm;
      margin: 0;                 /* no outer margin */
    }

    /* Two side-by-side copies */
    .sheet {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 5mm;                  /* tighter gap to fit one page */
      align-items: start;
      height: 100%;
      padding: 4mm;              /* tiny inner breathing room */
    }

    .copy {
      border: 1px solid #000;
      padding: 4mm;              /* compact padding */
      page-break-inside: avoid;
      break-inside: avoid;
      display: flex;
      flex-direction: column;
      min-height: 100%;
      overflow: hidden;
    }

    /* Header (black with white text) */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 3mm;
      padding: 3mm;
      background: #000;
      color: #fff;
    }
    .header .muted { color: #ccc; }
    .title { font-size: 16pt; }

    /* Field grid */
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2mm 4mm;              /* tighter so everything fits */
      margin-bottom: 2mm;
    }
    .full { grid-column: 1 / -1; }

    /* Red section labels */
    .label {
      font-size: 9pt;
      color: #c00;
      text-transform: uppercase;
      font-weight: 700;
      letter-spacing: .02em;
    }
    .value {
      font-weight: 600;
      word-break: break-word;
    }

    .mono {
      font: 10pt ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      white-space: pre-wrap;
      border: 1px solid #000;
      padding: 2mm;              /* compact text areas */
      margin-top: 1mm;
      background: #f7f7f7;
    }

    .badge {
      display: inline-block;
      border: 1px solid #000;
      padding: 1pt 4pt;
      font-size: 9pt;
      margin-right: 3mm;
    }

    /* Bottom notice */
    .notice {
      margin-top: 4mm;
      padding-top: 2mm;
      border-top: 1px solid #000;
      text-align: center;
      font-weight: 800;
      letter-spacing: .08em;
    }

    /* Print rules: hard lock to A4 landscape, zero margins */
    @page {
      size: A4 landscape;
      margin: 0;
    }
    @media print {
      html, body { width: 297mm; height: 210mm; }
      .page { page-break-after: always; }
      a { color: inherit; text-decoration: none; }
    }

    /* Optional: center nicely when viewing on screen */
    @media screen {
      body { display: grid; place-items: start center; padding: 8px; }
    }
  </style>

</head>
<body>
  <div class="sheet page">
    {% for _ in "12" %}
    <section class="copy">
      <header class="header">
        <h1 class="title">TPC #{{ tpc.pk }}</h1>
        <div class="muted">
          <div><small>Date requested:</small> {{ tpc.date_requested }}</div>
          <div><small>Expiration:</small> {{ tpc.expiration_date }}</div>
        </div>
      </header>

      <div class="grid">
        <div>
          <div class="label">Approved?</div>
          <div class="value">
            {% if tpc.approved %}✅ Fully approved{% else %}
              {{ tpc.approvals.count }}/{{ tpc.required_approvals_count }}
            {% endif %}
          </div>
        </div>

        <div>
          <div class="label">Supplier Issue</div>
          <div class="value">{{ tpc.supplier_issue|yesno:"Yes,No" }}</div>
        </div>

        <div>
          <div class="label">Issuer</div>
          <div class="value">{{ tpc.issuer_name|default:"—" }}</div>
        </div>

        <div>
          <div class="label">Feature</div>
          <div class="value">{{ tpc.feature|default:"—" }}</div>
        </div>

        <!-- Parts and Machines now side-by-side (not .full) -->
        <div>
          <div class="label">Parts</div>
          <div class="value">
            {% if tpc.parts %}{{ tpc.parts|join:", " }}{% else %}—{% endif %}
          </div>
        </div>

        <div>
          <div class="label">Machines</div>
          <div class="value">
            {% if tpc.machines %}{{ tpc.machines|join:", " }}{% else %}—{% endif %}
          </div>
        </div>

        <div class="full">
          <div class="label">Reason</div>
          <div class="mono">{{ tpc.reason|default:"—" }}</div>
        </div>

        <div class="full">
          <div class="label">Process</div>
          <div class="mono">{{ tpc.process|default:"—" }}</div>
        </div>

        <div class="full">
          <div class="label">Current Process</div>
          <div class="mono">{{ tpc.current_process|default:"—" }}</div>
        </div>

        <div class="full">
          <div class="label">Changed To</div>
          <div class="mono">{{ tpc.changed_to|default:"—" }}</div>
        </div>

        <div class="full">
          <div class="label">Approvals</div>
          <div class="value">
            <span class="badge">{{ tpc.approvals.count }}/{{ tpc.required_approvals_count }}</span>
            {% for a in tpc.approvals.all %}
              {{ a.user.get_full_name|default:a.user.username }}{% if not forloop.last %}, {% endif %}
            {% empty %}—{% endfor %}
          </div>
          {% if tpc.approved_by %}
          <div class="muted" style="margin-top:2mm;">
            <small>Last approved by {{ tpc.approved_by.get_full_name|default:tpc.approved_by.username }} on {{ tpc.approved_at }}</small>
          </div>
          {% endif %}
        </div>
      </div>

      <div class="notice" style="color: orange;">PRINT ON ORANGE PAPER</div>
    </section>
    {% endfor %}
  </div>
</body>
</html>
