{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrap Form</title>
    <link href="{% static 'bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <style>
        .bordered {
            border: 1px solid #000;
            padding: 10px;
        }
        .selected-part {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 5px 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .selected-part .close {
            cursor: pointer;
            font-size: 1.2rem;
            line-height: 1;
        }
    </style>
</head>
<body>

<div class="container mt-4">
    <!-- Title Row -->
    <div class="row bordered mb-3">
        <div class="col-12 text-center">
            <h1>Final Inspection Defect Tally Sheet</h1>
        </div>
    </div>
    
    <!-- Part Numbers Row -->
    <div class="row bordered mb-3" id="part_numbers_row">
        <div class="col-12">
            <label for="part_number_filter">Part Number</label>
            <input type="text" id="part_number_filter" class="form-control" placeholder="Type to filter...">
            <div style="max-height: 150px; overflow-y: auto; margin-top: 10px;">
                <ul class="list-group list-group-flush" id="part_numbers">
                    {% for part in parts %}
                        <li class="list-group-item" onclick="selectPart('{{ part.part_number }}')">{{ part.part_number }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <!-- Header Row -->
    <div class="row bordered mb-3">
        <!-- Column 1 -->
        <div class="col-md-4">
            <div class="row">
                <div class="col-12">
                    <label for="date">Date</label>
                </div>
                <div class="col-12">
                    <input type="date" class="form-control" id="date">
                </div>
                <div class="col-12">
                    <label for="qty_inspected">Qty Inspected</label>
                </div>
                <div class="col-12">
                    <p id="qty_inspected" class="form-control-plaintext">0</p>
                    <!-- Selected part number will be displayed here -->
                    <div id="selected_part_container" class="mt-2"></div>
                </div>
            </div>
        </div>
        <!-- Column 2 -->
        <div class="col-md-4">
            <div class="row">
                <div class="col-12">
                    <label for="operators">Operator</label>
                </div>
                <div class="col-12">
                    <input type="text" class="form-control" id="operators">
                </div>
                <div class="col-12">
                    <label for="total_defects">Total Defects</label>
                </div>
                <div class="col-12">
                    <input type="number" class="form-control" id="total_defects" min="0" oninput="calculateTotalAccepted()">
                </div>
            </div>
        </div>

        <!-- Column 3 -->
        <div class="col-md-4">
            <div class="row">
                <div class="col-12">
                    <label for="shift">Shift</label>
                </div>
                <div class="col-12">
                    <div>
                        <input type="radio" id="shift1" name="shift" value="1">
                        <label for="shift1">1</label>
                        <input type="radio" id="shift2" name="shift" value="2">
                        <label for="shift2">2</label>
                        <input type="radio" id="shift3" name="shift" value="3">
                        <label for="shift3">3</label>
                    </div>
                </div>
                <div class="col-12 mt-3">
                    <label>Total Accepted</label>
                </div>
                <div class="col-12">
                    <p id="total_accepted" class="form-control-plaintext">0</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Grid Row -->
    <div class="row bordered mb-3">
        <div class="col-12">
            <div class="row">
                <!-- Header -->
                <div class="col-md-2 text-start">
                    <strong>Feat Name</strong>
                </div>
                <div class="col-md-2">
                    <strong>No. of Defects</strong>
                </div>
                <div class="col-md-2">
                    <strong>Actions</strong>
                </div>
                <div class="col-md-2 text-start">
                    <strong>Feat Name</strong>
                </div>
                <div class="col-md-2">
                    <strong>No. of Defects</strong>
                </div>
                <div class="col-md-2">
                    <strong>Actions</strong>
                </div>
            </div>

        <!-- Row 1 -->
        <div class="row mt-1">
            <div class="col-md-2">
                Window Height
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control no-of-defects" min="0" value="0">
            </div>
            <div class="col-md-2 d-flex justify-content-start align-items-start">
                <button type="button" class="btn btn-outline-secondary btn-md me-2" onclick="incrementDefect(this)">
                    &uarr;
                </button>
                <button type="button" class="btn btn-outline-secondary btn-md" onclick="decrementDefect(this)">
                    &darr;
                </button>
            </div>
            <div class="col-md-2">
                Pinion Hole Diameter
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control no-of-defects" min="0" value="0">
            </div>
            <div class="col-md-2 d-flex justify-content-start align-items-start">
                <button type="button" class="btn btn-outline-secondary btn-md me-2" onclick="incrementDefect(this)">
                    &uarr;
                </button>
                <button type="button" class="btn btn-outline-secondary btn-md" onclick="decrementDefect(this)">
                    &darr;
                </button>
            </div>
        </div>

        <!-- Row 2 -->
        <div class="row mt-1">
            <div class="col-md-2">
                Burrs
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control no-of-defects" min="0" value="0">
            </div>
            <div class="col-md-2 d-flex justify-content-start align-items-start">
                <button type="button" class="btn btn-outline-secondary btn-md me-2" onclick="incrementDefect(this)">
                    &uarr;
                </button>
                <button type="button" class="btn btn-outline-secondary btn-md" onclick="decrementDefect(this)">
                    &darr;
                </button>
            </div>
            <div class="col-md-2">
                Plate Spline Tooth Thickness O/S
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control no-of-defects" min="0" value="0">
            </div>
            <div class="col-md-2 d-flex justify-content-start align-items-start">
                <button type="button" class="btn btn-outline-secondary btn-md me-2" onclick="incrementDefect(this)">
                    &uarr;
                </button>
                <button type="button" class="btn btn-outline-secondary btn-md" onclick="decrementDefect(this)">
                    &darr;
                </button>
            </div>
        </div>

        <!-- Row 3 -->
        <div class="row mt-1">
            <div class="col-md-2">
                Plate Spline Major Diameter
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control no-of-defects" min="0" value="0">
            </div>
            <div class="col-md-2 d-flex justify-content-start align-items-start">
                <button type="button" class="btn btn-outline-secondary btn-md me-2" onclick="incrementDefect(this)">
                    &uarr;
                </button>
                <button type="button" class="btn btn-outline-secondary btn-md" onclick="decrementDefect(this)">
                    &darr;
                </button>
            </div>
            <div class="col-md-2">
                Damaged / Missing Teeth
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control no-of-defects" min="0" value="0">
            </div>
            <div class="col-md-2 d-flex justify-content-start align-items-start">
                <button type="button" class="btn btn-outline-secondary btn-md me-2" onclick="incrementDefect(this)">
                    &uarr;
                </button>
                <button type="button" class="btn btn-outline-secondary btn-md" onclick="decrementDefect(this)">
                    &darr;
                </button>
            </div>
        </div>

        <!-- Row 4 -->
        <div class="row mt-1">
            <div class="col-md-2">
                Dings / Dents
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control no-of-defects" min="0" value="0">
            </div>
            <div class="col-md-2 d-flex justify-content-start align-items-start">
                <button type="button" class="btn btn-outline-secondary btn-md me-2" onclick="incrementDefect(this)">
                    &uarr;
                </button>
                <button type="button" class="btn btn-outline-secondary btn-md" onclick="decrementDefect(this)">
                    &darr;
                </button>
            </div>
            <div class="col-md-2">
                Stuck Deburr Media
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control no-of-defects" min="0" value="0">
            </div>
            <div class="col-md-2 d-flex justify-content-start align-items-start">
                <button type="button" class="btn btn-outline-secondary btn-md me-2" onclick="incrementDefect(this)">
                    &uarr;
                </button>
                <button type="button" class="btn btn-outline-secondary btn-md" onclick="decrementDefect(this)">
                    &darr;
                </button>
            </div>
        </div>

        <!-- Row 5 -->
        <div class="row mt-1">
            <div class="col-md-2">
                Missing Braze
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control no-of-defects" min="0" value="0">
            </div>
            <div class="col-md-2 d-flex justify-content-start align-items-start">
                <button type="button" class="btn btn-outline-secondary btn-md me-2" onclick="incrementDefect(this)">
                    &uarr;
                </button>
                <button type="button" class="btn btn-outline-secondary btn-md" onclick="decrementDefect(this)">
                    &darr;
                </button>
            </div>
            <div class="col-md-2">
                Cracks
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control no-of-defects" min="0" value="0">
            </div>
            <div class="col-md-2 d-flex justify-content-start align-items-start">
                <button type="button" class="btn btn-outline-secondary btn-md me-2" onclick="incrementDefect(this)">
                    &uarr;
                </button>
                <button type="button" class="btn btn-outline-secondary btn-md" onclick="decrementDefect(this)">
                    &darr;
                </button>
            </div>
        </div>

        <!-- Row 6 -->
        <div class="row mt-1">
            <div class="col-md-2">
                Blowout / Porosity
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control no-of-defects" min="0" value="0">
            </div>
            <div class="col-md-2 d-flex justify-content-start align-items-start">
                <button type="button" class="btn btn-outline-secondary btn-md me-2" onclick="incrementDefect(this)">
                    &uarr;
                </button>
                <button type="button" class="btn btn-outline-secondary btn-md" onclick="decrementDefect(this)">
                    &darr;
                </button>
            </div>
            <div class="col-md-2">
                Pallet Melted in Window
            </div>
            <div class="col-md-2">
                <input type="number" class="form-control no-of-defects" min="0" value="0">
            </div>
            <div class="col-md-2 d-flex justify-content-start align-items-start">
                <button type="button" class="btn btn-outline-secondary btn-md me-2" onclick="incrementDefect(this)">
                    &uarr;
                </button>
                <button type="button" class="btn btn-outline-secondary btn-md" onclick="decrementDefect(this)">
                    &darr;
                </button>
            </div>
        </div>
        <!-- Additional rows here... -->
    </div>
</div>


</div>

<script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script>
    // Function to filter the part numbers list based on input
    document.getElementById('part_number_filter').addEventListener('input', function() {
        const filter = this.value.toLowerCase();
        const listItems = document.querySelectorAll('#part_numbers .list-group-item');

        listItems.forEach(function(item) {
            if (item.textContent.toLowerCase().includes(filter)) {
                item.style.display = '';
            } else {
                item.style.display = 'none';
            }
        });
    });

    // Function to handle part number selection
    function selectPart(partNumber) {
        const selectedPartContainer = document.getElementById('selected_part_container');
        const partNumbersRow = document.getElementById('part_numbers_row');

        // Display the selected part and hide the part numbers row
        selectedPartContainer.innerHTML = `
            <div class="selected-part">
                <span>${partNumber}</span>
                <span class="close" onclick="removeSelectedPart()">×</span>
            </div>
        `;
        partNumbersRow.style.display = 'none'; // Hide the part numbers row
    }

    // Function to remove selected part number
    function removeSelectedPart() {
        const selectedPartContainer = document.getElementById('selected_part_container');
        const partNumbersRow = document.getElementById('part_numbers_row');

        // Clear the selected part and show the part numbers row again
        selectedPartContainer.innerHTML = '';
        partNumbersRow.style.display = 'block'; // Show the part numbers row
    }

    function incrementDefect(button) {
        let input = button.closest('.d-flex').previousElementSibling.querySelector('.no-of-defects');
        input.value = parseInt(input.value) + 1;
        updateQtyInspected();
        calculateTotalAccepted();
    }

    function decrementDefect(button) {
        let input = button.closest('.d-flex').previousElementSibling.querySelector('.no-of-defects');
        if (input.value > 0) {
            input.value = parseInt(input.value) - 1;
            updateQtyInspected();
            calculateTotalAccepted();
        }
    }

    function updateQtyInspected() {
        let defects = document.querySelectorAll('.no-of-defects');
        let totalInspected = 0;

        defects.forEach(function(defect) {
            totalInspected += parseInt(defect.value);
        });

        document.getElementById('qty_inspected').textContent = totalInspected;
    }

    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('date').value = today;

        // Attach input event listeners to all .no-of-defects fields
        const defectInputs = document.querySelectorAll('.no-of-defects');
        defectInputs.forEach(function(input) {
            input.addEventListener('input', function() {
                updateQtyInspected();
                calculateTotalAccepted();
            });
        });
    });

    function calculateTotalAccepted() {
        var qtyInspected = document.getElementById('qty_inspected').textContent;
        var totalDefects = document.getElementById('total_defects').value;
        var totalAccepted = document.getElementById('total_accepted');

        if (qtyInspected && totalDefects) {
            totalAccepted.textContent = qtyInspected - totalDefects;
        } else {
            totalAccepted.textContent = '';
        }
    }
</script>
</body>
</html>
