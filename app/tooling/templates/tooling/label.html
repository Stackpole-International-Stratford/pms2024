{% load static %}
{% load django_bootstrap5 %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Label PDF</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script>
        function generatePDF(toolLifeData) {
            const { jsPDF } = window.jspdf;
            const pdfWidth = 40;  // Adjust based on content
            const pdfHeight = 59; // Adjust based on content

            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: [pdfHeight, pdfWidth]
            });

            let yPosition = 5; // Initial Y position
            const keyColumnWidth = 20; // Width of the key column
            const valueColumnStart = keyColumnWidth + 2; // Start position of the value column

            doc.setFontSize(10); 
            doc.setTextColor(0, 0, 0);

            // Single column layout without margins
            doc.setFont("helvetica", "bold");
            doc.text("Machine No:", 2, yPosition);
            doc.setFont("helvetica", "normal");
            doc.text(`${toolLifeData.machine}`, valueColumnStart, yPosition);

            yPosition += 7; // Move down for the next line
            doc.setFont("helvetica", "bold");
            doc.text("Status:", 2, yPosition);
            doc.setFont("helvetica", "normal");
            doc.text(`${toolLifeData.tool_status}`, valueColumnStart, yPosition);

            yPosition += 7; // Move down for the next line
            doc.setFont("helvetica", "bold");
            doc.text("Tool:", 2, yPosition);
            doc.setFont("helvetica", "normal");
            doc.text(`${toolLifeData.tool_type}`, valueColumnStart, yPosition);

            yPosition += 7; // Move down for the next line
            doc.setFont("helvetica", "bold");
            doc.text("Tool Life:", 2, yPosition);
            doc.setFont("helvetica", "normal");
            doc.text(`${toolLifeData.actual_tool_life}`, valueColumnStart, yPosition);

            yPosition += 7; // Move down for the next line
            doc.setFont("helvetica", "bold");
            doc.text("Serial:", 2, yPosition);
            doc.setFont("helvetica", "normal");
            doc.text(`${toolLifeData.tool_serial_number}`, valueColumnStart, yPosition);

            yPosition += 7; // Move down for the next line
            doc.setFont("helvetica", "bold");
            doc.text("Issue:", 2, yPosition);
            doc.setFont("helvetica", "normal");
            doc.text(`${toolLifeData.tool_issue}`, valueColumnStart, yPosition);

            // Generate the PDF as a data URL
            const pdfData = doc.output('dataurlstring');
            document.getElementById('pdfIframe').src = pdfData;
        }
    </script>
</head>
<body>
    {% if tool_life_data %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toolLifeData = {
                machine: "{{ tool_life_data.machine }}",
                tool_status: "{{ tool_life_data.tool_status }}",
                tool_type: "{{ tool_life_data.tool_type }}",
                actual_tool_life: "{{ tool_life_data.actual_tool_life }}",
                tool_serial_number: "{{ tool_life_data.tool_serial_number }}",
                tool_issue: "{{ tool_life_data.tool_issue }}"
            };
            generatePDF(toolLifeData);
        });
    </script>
    {% endif %}
    <div>
        <iframe id="pdfIframe" width="100%" height="600px"></iframe>
    </div>
    <button onclick="window.print()">Print</button>
    <button onclick="window.history.back()">Back</button>
</body>
</html>
