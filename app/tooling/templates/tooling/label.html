{% load static %}
{% load django_bootstrap5 %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Label PDF</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script>
        function generatePDF(toolLifeData) {
            const { jsPDF } = window.jspdf;
            const pdfWidth = 40;  // Adjust based on content
            const pdfHeight = 59; // Adjust based on content

            const doc = new jsPDF({
                orientation: 'landscape',
                unit: 'mm',
                format: [pdfHeight, pdfWidth]
            });

            const margin = 5; // Add margin for better content positioning
            let yPosition = margin + 5; // Initial Y position

            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);

            // Single column layout
            doc.setFont("helvetica", "bold");
            doc.text("Machine No:", margin, yPosition);
            doc.setFont("helvetica", "normal");
            doc.text(`${toolLifeData.machine}`, margin + 22, yPosition);

            yPosition += 5; // Move down for the next line
            doc.setFont("helvetica", "bold");
            doc.text("Status:", margin, yPosition);
            doc.setFont("helvetica", "normal");
            doc.text(`${toolLifeData.tool_status}`, margin + 22, yPosition);

            yPosition += 5; // Move down for the next line
            doc.setFont("helvetica", "bold");
            doc.text("Tool:", margin, yPosition);
            doc.setFont("helvetica", "normal");
            doc.text(`${toolLifeData.tool_type}`, margin + 22, yPosition);

            yPosition += 5; // Move down for the next line
            doc.setFont("helvetica", "bold");
            doc.text("Tool Life:", margin, yPosition);
            doc.setFont("helvetica", "normal");
            doc.text(`${toolLifeData.actual_tool_life}`, margin + 22, yPosition);

            yPosition += 5; // Move down for the next line
            doc.setFont("helvetica", "bold");
            doc.text("Serial:", margin, yPosition);
            doc.setFont("helvetica", "normal");
            doc.text(`${toolLifeData.tool_serial_number}`, margin + 22, yPosition);

            yPosition += 5; // Move down for the next line
            doc.setFont("helvetica", "bold");
            doc.text("Issue:", margin, yPosition);
            doc.setFont("helvetica", "normal");
            doc.text(`${toolLifeData.tool_issue}`, margin + 22, yPosition);

            // Generate the PDF as a data URL and open it in a new tab
            const pdfData = doc.output('dataurlstring');
            const pdfWindow = window.open("");
            pdfWindow.document.write("<iframe width='100%' height='100%' src='" + pdfData + "'></iframe>");
        }
    </script>
</head>
<body>
    {% if tool_life_data %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const toolLifeData = {
                machine: "{{ tool_life_data.machine }}",
                tool_status: "{{ tool_life_data.tool_status }}",
                tool_type: "{{ tool_life_data.tool_type }}",
                actual_tool_life: "{{ tool_life_data.actual_tool_life }}",
                tool_serial_number: "{{ tool_life_data.tool_serial_number }}",
                tool_issue: "{{ tool_life_data.tool_issue }}"
            };
            generatePDF(toolLifeData);
        });
    </script>
    {% endif %}
    <button onclick="window.history.back()">Back</button>
</body>
</html>
