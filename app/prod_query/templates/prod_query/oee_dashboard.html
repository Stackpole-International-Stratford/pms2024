{% extends "parent.html" %}

{% block content %}
<div class="container my-4">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12 text-center">
      <h1 class="display-5">
        <span id="selected-date-display">7am {{ previous_day }} to 7am {{ end_date }}</span>
      </h1>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <div class="row">
        <!-- Calendar Column -->
        <div class="col-md-6 mb-3 mb-md-0">
          <div id="calendar"></div>
          <!-- Exclude Weekends checkbox (currently hidden) -->
          <div class="form-check mt-3">
            <input class="form-check-input" type="checkbox" id="exclude-weekends" checked style="display: none;">
            <label class="form-check-label" for="exclude-weekends" style="display: none;">
              Exclude weekends
            </label>
          </div>
          <button id="submit-dates" class="btn btn-dark mt-3">Submit Dates</button>
        </div>
        
        <!-- OEE Metrics Column -->
        <div class="col-md-6 d-flex flex-column justify-content-center">
          <div class="card text-center">
            <div class="card-body">
              <!-- Main OEE Display -->
              <h2 id="overall-OEE" class="display-3 mb-1">Loading...</h2>
              <p class="lead mb-4">Overall OEE</p>
              <!-- Sub-metrics Row -->
              <div class="row">
                <div class="col">
                  <h5 id="overall-A" class="mb-0">Loading...</h5>
                  <small>Availability (A)</small>
                </div>
                <div class="col">
                  <h5 id="overall-P" class="mb-0">Loading...</h5>
                  <small>Performance (P)</small>
                </div>
                <div class="col">
                  <h5 id="overall-Q" class="mb-0">Loading...</h5>
                  <small>Quality (Q)</small>
                </div>
              </div>
            </div> <!-- card-body -->
          </div> <!-- card -->
        </div>
      </div> <!-- row -->
    </div> <!-- card-body -->
  </div> <!-- card -->
</div> <!-- container -->
{% endblock %}

{% block extra_scripts %}
  {{ block.super }}
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Initialize flatpickr on the #calendar element with range selection.
      const calendarInstance = flatpickr("#calendar", {
        mode: "range",
        inline: true,
        enableTime: true,         // Enable time selection.
        time_24hr: true,          // Use 24-hour time format.
        dateFormat: "Y-m-d H:i",  // Include time in the date format.
        // Default dates passed from the view context.
        defaultDate: ["{{ start_date }}", "{{ end_date }}"]
      });
    });
  </script>
{% endblock %}
