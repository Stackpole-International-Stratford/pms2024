{# templates/prod_query/targets_list.html #}
{% extends "parent.html" %}

{% block content %}
  <h1>Machine Targets</h1>

  {% if targets %}
    <table id="targets-table" class="table table-striped">
      <thead>
        <tr>
          <th>Machine ID</th>
          <th>Line</th>
          <th>Target Cycle Time (s)</th>
          <th>Effective (EST)</th>
          <th>Created At</th>
        </tr>
        <!-- live‐filter inputs -->
        <tr>
          <th>
            <input type="text"
                   class="column-filter form-control"
                   data-column="0"
                   placeholder="Filter Machine…">
          </th>
          <th>
            <input type="text"
                   class="column-filter form-control"
                   data-column="1"
                   placeholder="Filter Line…">
          </th>
          <th>
            <input type="text"
                   class="column-filter form-control"
                   data-column="2"
                   placeholder="Filter Cycle…">
          </th>
          <th>
            <input type="text"
                   class="column-filter form-control"
                   data-column="3"
                   placeholder="Filter Effective…">
          </th>
          <th>
            <input type="text"
                   class="column-filter form-control"
                   data-column="4"
                   placeholder="Filter Created…">
          </th>
        </tr>
      </thead>

      <tbody>
        {% for t in targets %}
          <tr>
            <td>{{ t.machine_id }}</td>
            <td>{{ t.line|default:"—" }}</td>
            <td>
              {% if t.cycle_time_seconds %}
                {{ t.cycle_time_seconds|floatformat:2 }}
              {% else %}
                —
              {% endif %}
            </td>
            <td>{{ t.effective_date_est|date:"Y‑m‑d" }}</td>
            <td>{{ t.created_at|date:"Y‑m‑d H:i:s" }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
      const table   = document.getElementById('targets-table');
      const filters = table.querySelectorAll('.column-filter');

      function filterTable() {
        const vals = Array.from(filters)
                          .map(f => f.value.trim().toLowerCase());

        Array.from(table.tBodies[0].rows).forEach(row => {
          const cells = row.cells;
          const show = vals.every((v,i) =>
            !v || cells[i].textContent.toLowerCase().includes(v)
          );
          row.style.display = show ? '' : 'none';
        });
      }

      filters.forEach(inp => inp.addEventListener('input', filterTable));
    });
    </script>
  {% else %}
    <p>No targets have been set yet.</p>
  {% endif %}
{% endblock %}
