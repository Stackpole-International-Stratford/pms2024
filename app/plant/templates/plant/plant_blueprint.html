{# plant/plant_blueprint.html #}
{% extends "parent.html" %}

{% block title %}Plant Blueprint{% endblock %}

{% block content %}
<div class="container my-4">
  <h1 class="mb-4">Plant Blueprint</h1>

  <table id="plant-table" class="table table-bordered table-striped table-hover">
    <thead>
      <tr>
        <th>Line Name</th>
        <th>Operation</th>
        <th>Machine Name</th>
        <th>Part Number</th>
        <th>Cycle Time</th>
        <th>Effective Date (EST/EDT)</th>
        <th>Created At</th>
      </tr>
      <tr>
        <!-- one input per visible column, data-col-index matches its zero-based column -->
        <th><input type="text" class="form-control column-search" placeholder="Search line"       data-col-index="0"></th>
        <th><input type="text" class="form-control column-search" placeholder="Search operation"  data-col-index="1"></th>
        <th><input type="text" class="form-control column-search" placeholder="Search machine"    data-col-index="2"></th>
        <th><input type="text" class="form-control column-search" placeholder="Search part #"      data-col-index="3"></th>
        <th><input type="text" class="form-control column-search" placeholder="Search cycle time" data-col-index="4"></th>
        <th><input type="text" class="form-control column-search" placeholder="Search effective"  data-col-index="5"></th>
        <th><input type="text" class="form-control column-search" placeholder="Search created at" data-col-index="6"></th>
      </tr>
    </thead>
    <tbody>
      {% if records %}
        {% for rec in records %}
        <tr>
          <td>{{ rec.line_name }}</td>
          <td>{{ rec.operation }}</td>
          <td>{{ rec.machine_name }}</td>
          <td>{{ rec.part_number }}</td>
          <td>{{ rec.cycle_time }}</td>
          <td>{{ rec.effective_dt|date:"Y-m-d H:i" }}</td>
          <td>{{ rec.created_at|date:"Y-m-d H:i" }}</td>
        </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="7" class="text-center font-italic">
            No PlantSpine records found.
          </td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>

<script>
// Live, per-column filtering (layered)
document.addEventListener('DOMContentLoaded', function() {
  const table = document.getElementById('plant-table');
  const inputs = Array.from(table.querySelectorAll('.column-search'));

  function applyFilters() {
    const filters = inputs.map(i => i.value.trim().toLowerCase());
    table.querySelectorAll('tbody tr').forEach(row => {
      const cells = Array.from(row.cells);
      const isVisible = filters.every((f, idx) => {
        return !f || cells[idx].textContent.toLowerCase().includes(f);
      });
      row.style.display = isVisible ? '' : 'none';
    });
  }

  inputs.forEach(i => i.addEventListener('input', applyFilters));
});
</script>
{% endblock %}
