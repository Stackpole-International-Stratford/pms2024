{% extends "parent.html" %}

{% block content %}
  <div class="container mt-4">
    {% if error %}
      <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    {% if submitted %}
      <div class="alert alert-success">
        You submitted: {{ entry.first_name }} {{ entry.last_name }}, 
        Area {{ entry.area }} at {{ entry.timestamp|date:"Y-m-d H:i:s" }}
      </div>
    {% endif %}

    <form id="heatBreakForm" method="post" class="needs-validation" novalidate>
      {% csrf_token %}

      <div class="mb-3">
        <label for="firstName" class="form-label">First Name</label>
        <input
          type="text"
          class="form-control"
          id="firstName"
          name="first_name"
          required
        >
        <div class="invalid-feedback">
          Please enter your first name.
        </div>
      </div>

      <div class="mb-3">
        <label for="lastName" class="form-label">Last Name</label>
        <input
          type="text"
          class="form-control"
          id="lastName"
          name="last_name"
          required
        >
        <div class="invalid-feedback">
          Please enter your last name.
        </div>
      </div>

      <div class="mb-3">
        <label for="areaSelect" class="form-label">Area</label>
        <select
          class="form-select"
          id="areaSelect"
          name="area"
          required
        >
          <option value="" disabled selected>Chooseâ€¦</option>
          <option value="1">Area 1</option>
          <option value="2">Area 2</option>
          <option value="3">Area 3</option>
        </select>
        <div class="invalid-feedback">
          Please select an area.
        </div>
      </div>

      <button type="submit" class="btn btn-primary">
        Submit
      </button>
    </form>
  </div>

  <!-- Confirmation Modal -->
  <div
    class="modal fade"
    id="confirmModal"
    tabindex="-1"
    aria-labelledby="confirmModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmModalLabel">
            Please Confirm
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          Are you sure this information is correct?
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            id="confirmSubmitBtn"
          >
            Confirm
          </button>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
  (function(){
    'use strict';

    const form      = document.getElementById('heatBreakForm');
    const confirmBtn= document.getElementById('confirmSubmitBtn');

    // Bootstrap validation + modal interlock
    form.addEventListener('submit', function(e){
      if (!form.checkValidity()) {
        e.preventDefault();
        e.stopPropagation();
        form.classList.add('was-validated');
      } else {
        e.preventDefault();
        new bootstrap.Modal(
          document.getElementById('confirmModal')
        ).show();
      }
    });

    confirmBtn.addEventListener('click', function(){
      form.submit();
    });
  })();
</script>
{% endblock %}
