<h1>Create {{ form_type.name }} Form</h1>

<form method="POST">
    {% csrf_token %}
    
    <!-- Render the form for form-specific metadata -->
    {{ form.as_p }}

    <h3>Questions</h3>

    <div id="question-formset">
        {{ question_formset.management_form }}
        {% for form in question_formset %}
            <div class="question-form">
                {{ form.as_p }}
                <button type="button" class="delete-question">Delete Question</button>
            </div>
        {% endfor %}
    </div>

    <button type="button" id="add-question">Add Question</button>
    <button type="submit">Save Form</button>
</form>

<script>
    document.getElementById('add-question').addEventListener('click', function() {
        var formCount = document.querySelectorAll('.question-form').length;
        var formClone = document.querySelector('.question-form').cloneNode(true);
    
        // Update the names and IDs of the cloned form fields
        var formRegex = new RegExp(`form-(\\d+)-`, 'g');
        formClone.innerHTML = formClone.innerHTML.replace(formRegex, `form-${formCount}-`);
    
        // Append the cloned form to the formset container
        document.getElementById('question-formset').appendChild(formClone);
    
        // Update the management form's TOTAL_FORMS count
        document.getElementById('id_form-TOTAL_FORMS').value = formCount + 1;
    });
    
</script>
